# ğŸ“Š VTTech API Access Report

**NgÃ y táº¡o:** 2025-12-25  
**User test:** ittest123 (ID: 324)

---

## ğŸ” Káº¿t Luáº­n ChÃ­nh

User `ittest123` cÃ³ quyá»n háº¡n cháº¿:
- âŒ **KHÃ”NG CÃ“** quyá»n truy cáº­p module Customer
- âŒ **KHÃ”NG CÃ“** quyá»n truy cáº­p module Revenue chi tiáº¿t  
- âŒ **KHÃ”NG CÃ“** quyá»n truy cáº­p module Employee
- âœ… **CÃ“** quyá»n truy cáº­p module Appointment (háº¡n cháº¿)
- âœ… **CÃ“** quyá»n truy cáº­p API SessionData

---

## âœ… Working Endpoints

### 1. API Endpoints

| Endpoint | Method | Dá»¯ liá»‡u tráº£ vá» |
|----------|--------|----------------|
| `/api/Author/Login` | POST | Token, UserInfo |
| `/api/Home/SessionData` | POST | 11 tables master data |

### 2. Page Handlers

| Page | Handler | Dá»¯ liá»‡u |
|------|---------|---------|
| `/Appointment/AppointmentByDay/` | `LoadCombo` | 12 combo lists |

---

## ğŸ“¦ Dá»¯ Liá»‡u Tá»« SessionData API

```
Table    - branches: 17 chi nhÃ¡nh
Table1   - users: 32 users  
Table2   - services: 1,728 dá»‹ch vá»¥
Table3   - service_groups: 86 nhÃ³m dá»‹ch vá»¥
Table4   - employees: 1,620 nhÃ¢n viÃªn
Table5   - customer_sources: 1,069 nguá»“n KH
Table6   - customer_group: 34 nhÃ³m KH
Table7   - regions: 34 vÃ¹ng
Table8   - schedule_types: 242 loáº¡i lá»‹ch háº¹n
Table9   - wards: 3,321 phÆ°á»ng/xÃ£
Table10  - cities: 34 tá»‰nh/thÃ nh
```

---

## ğŸ“¦ Dá»¯ Liá»‡u Tá»« Appointment LoadCombo

```
Type           - 2 loáº¡i
Employee       - 1,620 nhÃ¢n viÃªn  
Branch         - 17 chi nhÃ¡nh
Status         - 7 tráº¡ng thÃ¡i
Doctor         - 101 bÃ¡c sÄ©
Membership     - 6 háº¡ng thÃ nh viÃªn
SchedulerType  - 15 loáº¡i lá»‹ch
CustomerGroup  - 87 nhÃ³m KH
ReasonCancel   - 5 lÃ½ do há»§y
Tele           - 173 telesale
Tag            - 2 tags
ServiceAll     - 1,728 dá»‹ch vá»¥
```

---

## ğŸ”’ Restricted Endpoints (User khÃ´ng cÃ³ quyá»n)

### Customer Module
CÃ¡c endpoint tá»« file `apicustomerdetail.md`:

| Tab | Endpoint | Status |
|-----|----------|--------|
| Dá»‹ch vá»¥ | `/Customer/Service/TabList/TabList_Service/?handler=LoadInitialize` | ğŸ”’ No Access |
| Dá»‹ch vá»¥ | `/Customer/Service/TabList/TabList_Service/?handler=LoadataTab` | ğŸ”’ No Access |
| Dá»‹ch vá»¥ | `/Customer/Service/TabList/TabList_Service/?handler=LoadServiceTab` | ğŸ”’ No Access |
| Dá»‹ch vá»¥ | `/Customer/Service/TabList/TabList_Service/?handler=LoadInfo_Treatment_Plant` | ğŸ”’ No Access |
| Äiá»u trá»‹ | `/Customer/Treatment/TreatmentList/TreatmentList_Service/?handler=LoadComboMain` | ğŸ”’ No Access |
| Äiá»u trá»‹ | `/Customer/Treatment/TreatmentList/TreatmentList_Service/?handler=LoadataTreatment` | ğŸ”’ No Access |
| Thanh toÃ¡n | `/Customer/Payment/PaymentList/PaymentList_Service/?handler=LoadataPayment` | ğŸ”’ No Access |
| HÃ¬nh áº£nh | `/Customer/CustomerImage/?handler=LoadImageByFolder` | ğŸ”’ No Access |
| HÃ¬nh áº£nh | `/Customer/CustomerImage/?handler=LoadTemplateForm` | ğŸ”’ No Access |
| Tráº£ gÃ³p | `/Customer/Installment/InstallmentList/?handler=LoadDetail` | ğŸ”’ No Access |
| Lá»‹ch sá»­ | `/Customer/History/HistoryList_Care/?handler=LoadataHistory` | ğŸ”’ No Access |
| Schedule | `/Customer/ScheduleList_Schedule/?handler=Loadata` | ğŸ”’ No Access |
| Complaint | `/Customer/ComplaintList/?handler=Loadata` | ğŸ”’ No Access |

### Other Modules
- `/Customer/List` - Customer list
- `/Customer/Detail/{id}` - Customer detail  
- `/Revenue/*` - Revenue reports
- `/Employee/*` - Employee management
- `/Service/*` - Service management
- `/Home/Index` - Dashboard

---

## ğŸ¯ Khuyáº¿n Nghá»‹

### Äá»ƒ truy cáº­p Customer Detail Endpoints:

1. **Cáº§n tÃ i khoáº£n cÃ³ quyá»n cao hÆ¡n** - LiÃªn há»‡ admin VTTech Ä‘á»ƒ cáº¥p quyá»n cho module Customer

2. **CÃ¡c quyá»n cáº§n thiáº¿t:**
   - Quyá»n xem Customer (Customer.View)
   - Quyá»n xem Treatment (Treatment.View)
   - Quyá»n xem Payment (Payment.View)
   - Quyá»n xem Appointment (Appointment.View)

3. **CÃ¡ch test vá»›i tÃ i khoáº£n khÃ¡c:**
   ```python
   # Thay Ä‘á»•i credentials trong code
   USERNAME = 'admin_user'
   PASSWORD = 'admin_password'
   ```

### Dá»¯ liá»‡u hiá»‡n cÃ³ thá»ƒ sync:

Vá»›i user `ittest123`, cÃ³ thá»ƒ sync:
- âœ… Master data (Branches, Services, Employees, etc.) tá»« SessionData
- âœ… Appointment combo data
- âŒ Revenue data (chá»‰ Ä‘Æ°á»£c tá»« script khÃ¡c vá»›i phÆ°Æ¡ng thá»©c khÃ¡c)
- âŒ Customer data
- âŒ Treatment data

---

## ğŸ“ Ghi ChÃº Ká»¹ Thuáº­t

### Authentication Flow:
```
1. POST /api/Author/Login â†’ Get Session token (JWT)
2. Set Cookie: WebToken = {token}
3. For Page handlers: 
   - GET page â†’ Extract XSRF token
   - POST with __RequestVerificationToken
4. For API endpoints:
   - Authorization: Bearer {token}
```

### Response Format:
- Responses are Base64 + Gzip compressed JSON
- Need to decode: `base64.b64decode()` â†’ `zlib.decompress()`

---

*Report generated by VTTech API Test Script*
